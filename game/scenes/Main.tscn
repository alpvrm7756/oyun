[gd_scene load_steps=22 format=3]

[ext_resource type="Script" path="res://scripts/game_manager.gd" id="1"]
[ext_resource type="Script" path="res://scripts/player.gd" id="2"]
[ext_resource type="Script" path="res://scripts/enemy.gd" id="3"]
[ext_resource type="Script" path="res://scripts/npc.gd" id="4"]
[ext_resource type="Environment" path="res://default_env.tres" id="5"]

[sub_resource type="BoxMesh" id="1"]
size = Vector3(40, 1, 40)

[sub_resource type="BoxMesh" id="2"]
size = Vector3(1, 2, 1)

[sub_resource type="StandardMaterial3D" id="3"]
albedo_color = Color(0.215686, 0.243137, 0.27451, 1)

[sub_resource type="BoxShape3D" id="4"]
size = Vector3(0.6, 1, 0.6)

[sub_resource type="BoxShape3D" id="5"]
size = Vector3(1.5, 1, 1.5)

[sub_resource type="BoxShape3D" id="6"]
size = Vector3(0.7, 1.2, 0.7)

[sub_resource type="SphereShape3D" id="7"]
radius = 5.0

[sub_resource type="SphereShape3D" id="8"]
radius = 2.5

[sub_resource type="Animation" id="9"]
resource_name = "idle"
length = 1.0
loop_mode = 1

[sub_resource type="Animation" id="10"]
resource_name = "walk"
length = 1.0
loop_mode = 1

[sub_resource type="Animation" id="11"]
resource_name = "attack"
length = 0.6
loop_mode = 0

[sub_resource type="Animation" id="12"]
resource_name = "die"
length = 0.8
loop_mode = 0

[sub_resource type="ParticlesMaterial" id="13"]
emission_box_extents = Vector3(0.4, 0.2, 0.4)
gravity = Vector3(0, -1, 0)
initial_velocity = 2.5

[sub_resource type="CapsuleMesh" id="14"]
radius = 0.45
height = 1.6

[sub_resource type="CapsuleMesh" id="15"]
radius = 0.4
height = 1.4

[node name="Main" type="Node3D"]

[node name="Environment" type="WorldEnvironment" parent="."]
environment = ExtResource("5")

[node name="Sun" type="DirectionalLight3D" parent="."]
rotation_degrees = Vector3(-45, -30, 0)
light_energy = 1.2

[node name="Ground" type="MeshInstance3D" parent="."]
mesh = SubResource("1")
material_override = SubResource("3")

[node name="Player" type="CharacterBody3D" parent="."]
transform = Transform3D(Basis.IDENTITY, Vector3(0, 1, 0))
script = ExtResource("2")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Player"]
shape = SubResource("4")

[node name="MeshInstance3D" type="MeshInstance3D" parent="Player"]
mesh = SubResource("14")

[node name="Pivot" type="Node3D" parent="Player"]
transform = Transform3D(Basis.IDENTITY, Vector3(0, 1.6, 0))
rotation_degrees = Vector3(-10, 0, 0)

[node name="Camera3D" type="Camera3D" parent="Player/Pivot"]
translation = Vector3(0, 0.4, 5.0)

[node name="SwordArea" type="Area3D" parent="Player"]
monitoring = false

[node name="CollisionShape3D" type="CollisionShape3D" parent="Player/SwordArea"]
shape = SubResource("5")
transform = Transform3D(Basis.IDENTITY, Vector3(0, 0.5, -1.0))

[node name="Enemy" type="CharacterBody3D" parent="."]
transform = Transform3D(Basis.IDENTITY, Vector3(10, 1, -5))
script = ExtResource("3")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Enemy"]
shape = SubResource("6")

[node name="MeshInstance3D" type="MeshInstance3D" parent="Enemy"]
mesh = SubResource("15")

[node name="PlayerDetector" type="Area3D" parent="Enemy"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Enemy/PlayerDetector"]
shape = SubResource("7")

[node name="AnimationPlayer" type="AnimationPlayer" parent="Enemy"]
"anims/idle" = SubResource("9")
"anims/walk" = SubResource("10")
"anims/attack" = SubResource("11")
"anims/die" = SubResource("12")

[node name="Campfire" type="Node3D" parent="."]
transform = Transform3D(Basis.IDENTITY, Vector3(-6, 0, 4))

[node name="NPC" type="Node3D" parent="Campfire"]
script = ExtResource("4")

[node name="MeshInstance3D" type="MeshInstance3D" parent="Campfire/NPC"]
mesh = SubResource("2")

[node name="PromptLabel" type="Label3D" parent="Campfire/NPC"]
position = Vector3(0, 2.5, 0)
text = "Press E"
billboard = 1

[node name="DetectionArea" type="Area3D" parent="Campfire/NPC"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Campfire/NPC/DetectionArea"]
shape = SubResource("8")

[node name="Fire" type="GPUParticles3D" parent="Campfire"]
emitting = true
amount = 64
process_material = SubResource("13")

[node name="GameManager" type="Node" parent="."]
script = ExtResource("1")

[node name="CanvasLayer" type="CanvasLayer" parent="GameManager"]
layer = 1

[node name="QuestPanel" type="Panel" parent="GameManager/CanvasLayer"]
anchor_right = 0.3
anchor_bottom = 0.2
offset_left = 20.0
offset_top = 20.0

[node name="MarginContainer" type="MarginContainer" parent="GameManager/CanvasLayer/QuestPanel"]
anchor_right = 1.0
anchor_bottom = 1.0

[node name="VBoxContainer" type="VBoxContainer" parent="GameManager/CanvasLayer/QuestPanel/MarginContainer"]
anchor_right = 1.0
anchor_bottom = 1.0

[node name="QuestLabel" type="Label" parent="GameManager/CanvasLayer/QuestPanel/MarginContainer/VBoxContainer"]
text = "Talk to the guide"

[node name="InteractionLabel" type="Label" parent="GameManager/CanvasLayer/QuestPanel/MarginContainer/VBoxContainer"]
text = "Press E to interact"
visible = false
